<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf8">
    <script type="text/javascript">
      var rid = query("rid");
      var uid = query("uid");

      function query(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");
        var r = window.location.search.substr(1).match(reg);
        if (r!=null) return (r[2]); return null;
      }

      function loadXMLDoc(url, cfunc) {
        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = cfunc;
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
      }

      function myFunction() {
        url = "http://connsvr.com:44392?cmd=2&subcmd=&rid="+rid+"&uid="+uid+"&sid=s1"+"&body=";
        loadXMLDoc(url, function() {
          if (this.readyState==4 && this.status==200) {
            document.getElementById("myDiv").innerHTML = 
                this.responseText + "<br/><br/>refresh time: "+ (new Date()).toLocaleTimeString();

            myFunction();
          }
        });
      }

      function send() {
        url = "http://logicsvr.com:8089/Demo/Pub?rid="+rid+"&body="+document.getElementById("body").value;
        loadXMLDoc(url, function() {
          if (this.readyState==4 && this.status==200) {
            document.getElementById("body").value = "";
          }
        });
      }

      myFunction()
    </script>
  </head>
  <body>
    <h2><div id="myDiv">msg here</div></h2>
    <input id="body" type="text" style="width:500px" value=""/> 
    <input type="button" value="发送" onclick="javascript:send();"/>
  </body>
</html>
